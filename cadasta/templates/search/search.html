{% extends "organization/project_wrapper.html" %}
{% load i18n %}

{% block page_title %}{% trans "Search" %} | {% endblock %}
{% block left-nav %}search{% endblock %}

{% block content %}

<div class="col-md-12 content-single">
  <div class="row">
    <!-- Main text  -->
    <div class="col-md-12 main-text">
      <div class="page-title">
        <h2>{% trans "Search" %}</h2>
      </div>
      <div class="panel panel-default">
        <div class="panel-body">
          <form action="#" id="search-form" data-search-api-url="{% url 'api:v1:search:search' object.organization.slug object.slug %}">
            <div>Last updated {minutes} minutes ago</div>
            <div class="form-group">
              <input type="search" id="search-input" class="form-control" value="{{ search_query }}">
              <button class="btn btn-primary"><span class="glyphicon glyphicon-search" aria-hidden="true"></span> {% trans "Go" %}</button>
              e.g. "Parcel", "John White", <a href=''>more search guidelines</a>
            </div>
          </form>
          {% if total_results == 0 %}
            <h3>We're sorry, we couldn't find any results for search: <strong>{{ search_terms }}</strong></h3>
            <div style='padding:20px'>
              <h4>Search tips:</h4>
              <ul>
              <li>Double check your spelling for typos.</li>
              <li>Use fewer keywords.</li>
              <li>Refer to our <a>search guidelines</a> for more tips.</li>
              </ul>
            </div>
          {% else %}
            <h3>Showing {{ total_results }} results for <strong>{{ search_terms }}</strong></h3>
              <table id="search-results" class="table table-hover datatable" data-paging-type="simple">
                <thead>
                  <tr>
                    <th class='entity-type'></th>
                    <th class='entity-main-label'></th>
                    <th class="col-md-12 entity-record">{% trans "Entity Record" %}</th>
                  </tr>
                </thead>
                  <tbody>
                    
                  </tbody>
                </table>
                </tr>
              </table>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
<script>
'use strict';

window.addEventListener('load', function() {
  $('#search-form').bind('submit', function(e) {
    var url = e.currentTarget.dataset.searchApiUrl;
    var query = $('#search-input')[0].value;
    $.get(url + '?q=' + query, function(response) {
      console.log(response.results)
      var t = $('#search-results').DataTable();
      t.column(0).visible(false)
      t.column(1).visible(false)
      if (t.rows().length !== 0) {
        t.rows().remove();
      }
      t.rows.add(response.results).draw();
    });
  });
});
</script>

{% endblock %}
